# Report

## 功能实现

本实验重写了 `sys_get_time` 和 `sys_task_info` ，由于要改变的结构体不一定全部储存在一个虚拟页表中，故需要调用 `translated_byte_buffer` 并在每个虚拟页表的相应位置更改值。

其次，本实验实现了 `mmap` 和 `munmap` 可以将给定的一段虚拟地址映射到物理地址上。在分配时需要取得段内的每个虚拟页对应的表项看是否已分配过。在取消映射时直接调用了 `PageTable` 中的 `munap` ，暂未对 `areas` 进行修正。

## 问答题

1. > 请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？

SV39页表项的组成如下：
53位~10位的44位为页表记录的物理页号
7位～0位为8个标记位，分别为DAGUXWRV
其中A记录这一位被清零后页表对应的虚拟页是否被访问过
D记录这一位被清零后页表项对应的虚拟页是否被修改过
G暂未定义
U表示这个页表项对应的虚拟页能否在U特权极下访问
R/W/X表示对应的虚拟页能否被读/写/取指
V表示当前页面是否有效合法

2. > 请问哪些异常可能是缺页导致的？

    缺页异常

    > 发生缺页时，描述相关重要寄存器的值，上次实验描述过的可以简略。

    发生缺页时会产生Trap，根据上次实验，存了 x1,x3,x5~x31,sstatus, sepc, sp(切换后的sscratch) 寄存器

    > 这样做有哪些好处？

    可以节省内存消耗；可以加快程序的启动时间；可以减少磁盘I/O消耗，平滑过渡

    > 处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？

    每一个页的大小为4K，共有10G/4K=2.5M个虚拟页。
    对于非叶节点，一个表项可存512个下级节点，由于只需估计数量级，故可只考虑最后一层叶节点的内存。
    每个表项的的大小为8字节，故页表共需要约20M的内存

    > 请简单思考如何才能实现 Lazy 策略，缺页时又如何处理？描述合理即可，不需要考虑实现。

    可以现在最开始分配虚拟地址的空间，但是不分配相应的物理地址，只有到第一次访问某个虚拟地址时，即缺页时，才分配相应的物理地址。

    > 此时页面失效如何表现在页表项(PTE)上？

    合法但是用户态不可访问，即将U标记设置为0

3. > 在单页表情况下，如何更换页表？

    将用户态使用的虚拟地址对应的页表全部置为不合法

    > 单页表情况下，如何控制用户态无法访问内核页面？（tips:看看上一题最后一问）

    将该表项的U标记设置为0

    > 单页表有何优势？（回答合理即可）

    实现较为简单；内存占用少；访问效率高

    > 双页表实现下，何时需要更换页表？假设你写一个单页表操作系统，你会选择何时更换页表（回答合理即可）？

    切换用户态和内核态时需要更换页表；实现单页表时会选择在进程切换时更换页表
   
## 荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 **以下各位** 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

无

2. 此外，我也参考了 **以下资料** ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

无

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。
